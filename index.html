<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDS CR Campaign | Live Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@400;700;900&display=swap');
        body { background-color: #020617; font-family: 'Inter', sans-serif; color: white; overflow-x: hidden; }
        .header-font { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .conqueror-tier { border-left: 4px solid #ef4444; background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%); }
        .master-tier { border-left: 4px solid #eab308; }
        .tab-active { color: #f97316; border-bottom: 2px solid #f97316; }
        .spin-anim { animation: spin 1s linear; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 max-w-lg mx-auto pb-20">

    <div class="flex justify-between items-center mb-6 px-2">
        <div class="flex flex-col">
            <span class="text-[10px] font-black tracking-widest text-red-500 uppercase italic">Live Feed</span>
            <span id="timestamp" class="text-[8px] text-slate-500 font-bold uppercase">Syncing...</span>
        </div>
        <button onclick="updateDashboard()" id="refresh-btn" class="glass p-2 px-3 rounded-lg"><i class="fas fa-sync-alt text-xs text-blue-400"></i></button>
    </div>

    <div class="text-center mb-8">
        <h1 class="header-font text-3xl font-black italic tracking-tighter bg-gradient-to-r from-yellow-400 to-red-600 bg-clip-text text-transparent">BDS PERFORMANCE</h1>
    </div>

    <div class="grid grid-cols-2 gap-2 mb-8">
        <div class="glass p-3 rounded-xl border-b-2 border-orange-500 text-center">
            <div class="text-[9px] font-black text-orange-500 uppercase">Weekly Floor</div>
            <div id="floor-total" class="text-2xl font-black">0</div>
        </div>
        <div class="glass p-3 rounded-xl border-b-2 border-blue-500 text-center">
            <div class="text-[9px] font-black text-blue-500 uppercase">Daily Floor</div>
            <div id="daily-floor-total" class="text-2xl font-black">0</div>
        </div>
    </div>

    <div class="flex border-b border-white/10 mb-6">
        <button onclick="switchTab('weekly')" id="tab-weekly" class="flex-1 py-3 text-[10px] font-black uppercase tab-active">Weekly</button>
        <button onclick="switchTab('daily')" id="tab-daily" class="flex-1 py-3 text-[10px] font-black uppercase text-slate-500">Daily Performance</button>
    </div>

    <div id="leaderboard" class="space-y-3"></div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyQlZ1H4TiC2Ohbw8IQNdxiCw0-bUMqgeH6wkmSzPdiJzps4d9aOn7YnWWdjraTli7DeQ/exec';
        let agents = [];
        let currentView = 'weekly';

        async function updateDashboard() {
            const btn = document.getElementById('refresh-btn');
            btn.classList.add('spin-anim');
            try {
                const res = await fetch(API_URL);
                agents = await res.json();
                render();
                document.getElementById('timestamp').innerText = `Updated: ${new Date().toLocaleTimeString()}`;
            } catch (e) {
                document.getElementById('timestamp').innerText = "Offline";
            } finally {
                setTimeout(() => btn.classList.remove('spin-anim'), 1000);
            }
        }

        function switchTab(view) {
            currentView = view;
            document.getElementById('tab-weekly').className = view === 'weekly' ? 'flex-1 py-3 text-[10px] font-black uppercase tab-active' : 'flex-1 py-3 text-[10px] font-black uppercase text-slate-500';
            document.getElementById('tab-daily').className = view === 'daily' ? 'flex-1 py-3 text-[10px] font-black uppercase tab-active' : 'flex-1 py-3 text-[10px] font-black uppercase text-slate-500';
            render();
        }

        function render() {
            const board = document.getElementById('leaderboard');
            let wFloor = 0, dFloor = 0;

            // Sorting logic: prioritize "XFER" then "daily" then "leads"
            const sorted = [...agents].sort((a, b) => {
                if (currentView === 'daily') {
                    const valA = Number(a.XFER || a.daily || 0);
                    const valB = Number(b.XFER || b.daily || 0);
                    return valB - valA;
                }
                return Number(b.leads || 0) - Number(a.leads || 0);
            });

            const html = sorted.map((agent, i) => {
                const weekly = Number(agent.leads || 0);
                const daily = Number(agent.XFER || agent.daily || 0);
                wFloor += weekly;
                dFloor += daily;

                const displayVal = currentView === 'daily' ? daily : weekly;
                const name = agent.name ? agent.name.split('-')[0].trim() : "Unknown";

                if (currentView === 'daily' && daily === 0) return '';

                return `
                    <div class="glass p-4 rounded-xl flex justify-between items-center ${weekly >= 12 ? 'master-tier' : ''}">
                        <div class="flex items-center gap-4">
                            <span class="text-sm font-black italic text-slate-600">#${i + 1}</span>
                            <span class="font-bold text-sm uppercase">${name}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-black ${currentView === 'daily' ? 'text-blue-400' : 'text-white'}">${displayVal}</div>
                            <div class="text-[7px] text-slate-500 font-bold uppercase">${currentView === 'daily' ? 'Today' : 'Total'}</div>
                        </div>
                    </div>
                `;
            }).join('');

            board.innerHTML = html || `<div class="text-center py-10 text-slate-500 text-xs">NO DAILY INFO FOUND. CHECK COLUMN NAME IN SHEET (MUST BE "XFER" OR "daily")</div>`;
            document.getElementById('floor-total').innerText = wFloor;
            document.getElementById('daily-floor-total').innerText = dFloor;
        }

        setInterval(updateDashboard, 30000);
        updateDashboard();
    </script>
</body>
</html>
