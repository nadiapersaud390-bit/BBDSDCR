<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDS LIVE TRACKER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@400;700;900&display=swap');
        body { background-color: #020617; font-family: 'Inter', sans-serif; color: white; }
        .header-font { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        
        /* Highlight animation for new leads */
        .row-update { animation: highlight 3s ease-out; }
        @keyframes highlight {
            0% { background-color: rgba(59, 130, 246, 0.6); transform: scale(1.02); }
            100% { background-color: transparent; transform: scale(1); }
        }

        .conqueror-tier { border-left: 4px solid #ef4444; background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%); }
        .master-tier { border-left: 4px solid #eab308; }
        .pro-tier { border-left: 4px solid #3b82f6; }
    </style>
</head>
<body class="p-4 max-w-lg mx-auto pb-20">

    <div class="text-center mb-6">
        <h1 class="header-font text-3xl font-black italic text-orange-500 tracking-tighter">BDS PERFORMANCE</h1>
        <div id="timestamp" class="text-[9px] text-slate-500 uppercase mt-1 font-bold">Syncing Live...</div>
    </div>

    <div class="grid grid-cols-2 gap-2 mb-8 text-center">
        <div class="glass p-3 rounded-xl border-b-2 border-orange-500">
            <div class="text-[10px] font-black text-orange-500 uppercase">Weekly Floor</div>
            <div id="floor-total" class="text-2xl font-black">0</div>
        </div>
        <div class="glass p-3 rounded-xl border-b-2 border-blue-500">
            <div class="text-[10px] font-black text-blue-500 uppercase">Daily Floor</div>
            <div id="daily-floor-total" class="text-2xl font-black">0</div>
        </div>
    </div>

    <div class="mb-10">
        <div class="flex justify-between items-end mb-4 px-1">
            <h2 class="header-font text-xs font-black text-blue-400 uppercase italic">Daily Leaders</h2>
            <span id="day-label" class="text-[10px] font-bold text-slate-500">THURSDAY</span>
        </div>
        <div id="daily-leaderboard" class="space-y-2">
            </div>
    </div>

    <div>
        <div class="flex justify-between items-end mb-4 px-1">
            <h2 class="header-font text-xs font-black text-slate-400 uppercase italic">Weekly Sprint</h2>
        </div>
        <div id="weekly-leaderboard" class="space-y-3">
            </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyQlZ1H4TiC2Ohbw8IQNdxiCw0-bUMqgeH6wkmSzPdiJzps4d9aOn7YnWWdjraTli7DeQ/exec';
        let previousData = [];

        async function updateData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                // 1. Calculate Daily & Sort
                const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                document.getElementById('day-label').innerText = today;

                // Sort Daily: Highest XFER first
                const dailyList = [...data].sort((a, b) => {
                    const valA = Number(a.XFER || a.daily || a[today] || 0);
                    const valB = Number(b.XFER || b.daily || b[today] || 0);
                    return valB - valA;
                });

                // Sort Weekly: Highest Leads first
                const weeklyList = [...data].sort((a, b) => Number(b.leads || 0) - Number(a.leads || 0));

                render(dailyList, weeklyList, today);
                
                // Check for highlights
                checkUpdates(data);
                previousData = JSON.parse(JSON.stringify(data));

                const now = new Date();
                document.getElementById('timestamp').innerText = `Last Sync: ${now.toLocaleTimeString()}`;
            } catch (e) {
                console.error("Fetch error", e);
            }
        }

        function render(daily, weekly, dayName) {
            const dailyCont = document.getElementById('daily-leaderboard');
            const weeklyCont = document.getElementById('weekly-leaderboard');
            
            let dFloor = 0;
            let wFloor = 0;

            // Render Daily
            dailyCont.innerHTML = daily.map((agent, i) => {
                const val = Number(agent.XFER || agent.daily || agent[dayName] || 0);
                dFloor += val;
                if (val === 0) return ''; // Hide 0s from daily list
                
                return `
                    <div class="glass p-3 rounded-lg flex justify-between items-center border-l-4 border-blue-500" id="daily-${agent.name.replace(/\s+/g, '')}">
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] font-bold text-slate-600 italic">#${i+1}</span>
                            <span class="text-xs font-bold uppercase tracking-tight">${agent.name.split('-')[0]}</span>
                        </div>
                        <span class="text-xl font-black text-blue-400">${val}</span>
                    </div>
                `;
            }).join('');

            // Render Weekly
            weeklyCont.innerHTML = weekly.map((agent, i) => {
                const leads = Number(agent.leads || 0);
                wFloor += leads;
                let tier = leads >= 17 ? 'conqueror-tier' : leads >= 12 ? 'master-tier' : 'pro-tier';
                
                return `
                    <div class="glass p-4 rounded-xl flex justify-between items-center ${tier}" id="weekly-${agent.name.replace(/\s+/g, '')}">
                        <div class="flex flex-col">
                            <span class="text-[8px] font-black text-slate-500 uppercase">${leads >= 12 ? 'Elite Class' : 'Active Rep'}</span>
                            <span class="text-sm font-black uppercase">${agent.name.split('-')[0]}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-black">${leads}</div>
                            <div class="text-[7px] font-bold text-slate-500 uppercase tracking-widest">Total</div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('floor-total').innerText = wFloor;
            document.getElementById('daily-floor-total').innerText = dFloor;
        }

        function checkUpdates(newData) {
            if (previousData.length === 0) return;
            
            newData.forEach(newAgent => {
                const oldAgent = previousData.find(oa => oa.name === newAgent.name);
                if (oldAgent && Number(newAgent.leads) > Number(oldAgent.leads)) {
                    const id = `weekly-${newAgent.name.replace(/\s+/g, '')}`;
                    const el = document.getElementById(id);
                    if (el) {
                        el.classList.add('row-update');
                        setTimeout(() => el.classList.remove('row-update'), 3000);
                    }
                }
            });
        }

        setInterval(updateData, 30000);
        updateData();
    </script>
</body>
</html>
